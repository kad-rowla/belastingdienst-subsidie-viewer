# https://www.w3.org/TR/shacl-af/#SPARQLTargetType

@prefix ex: <http://example.org/> .
@prefix sh: <http://www.w3.org/ns/shacl#> . # W3C Shapes Constraint Language (SHACL) Vocabulary
@prefix sdo: <https://schema.org/> . # Schema.org
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> . # The RDF Schema vocabulary (RDFS)
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> . # XML Schema Definition

ex:
	sh:declare [
		sh:prefix "ex" ;
		sh:namespace "http://example.org/"^^xsd:anyURI ;
	] .
				
sdo:
	sh:declare [
		sh:prefix "schema" ;
		sh:namespace "https://schema.org/"^^xsd:anyURI ;
	] .

ex:PeopleBornInCountryTarget
	a sh:SPARQLTargetType ;
	rdfs:subClassOf sh:Target ;
	sh:labelTemplate "All persons born in {$country}" ;
	sh:parameter [
		sh:path ex:country ;
		sh:description "The country that the focus nodes are 'born' in." ;
		sh:class sdo:Country ;
		sh:nodeKind sh:IRI ;
	] ;
	sh:prefixes ex:, sdo:;
	sh:select """
		SELECT ?this
		WHERE {
			?this a schema:Person .
			?this ex:bornIn $country .
		}
		""" .
  
ex:DutchCitizenShape
	a sh:NodeShape ;
  sh:property [
		sh:path ex:nationality ;
		sh:hasValue "Dutch" ;
    sh:minCount 1 ;
    sh:maxCount 1;
	];
	sh:target [
		a ex:PeopleBornInCountryTarget ;
		ex:country ex:Netherlands ;
	] ;

.

ex:USCitizenShape
	a sh:NodeShape ;
  sh:property [
		sh:path ex:nationality ;
		sh:hasValue "American" ;
    sh:minCount 1 ;
    sh:maxCount 1;
	];
	sh:target [
		a ex:PeopleBornInCountryTarget ;
		ex:country ex:USA ;
	] ;
.

# Instance data:
ex:John a sdo:Person ; ex:bornIn ex:USA; ex:nationality "Dutch" .
ex:Jane a sdo:Person ; ex:bornIn ex:USA; ex:nationality "American" .
ex:Jan a sdo:Person ; ex:bornIn ex:Netherlands; ex:nationality "Dutch" .

ex:USA a sdo:Country .
ex:Netherlands a sdo:Country .
