import tags, { type Tag } from 'language-tags'
import type Region from './Region.js'

export default class LanguageTag<T extends string = string> {
  protected $tag: Tag
  constructor (tag: T) {
    if (!tags.check(tag)) {
      throw new Error(`Tag '${tag}' is not a valid language tag.`)
    }
    this.$tag = tags(tag)
  }

  public toString (): string {
    return this.$tag.format()
  }

  public static isLanguageTag (obj: any): obj is LanguageTag {
    return obj !== undefined && typeof obj === 'object' && typeof obj.addRegion === 'function'
  }

  public addRegion<R extends string = string>(region: Region<R>): LanguageTag<`${T}-${R}`> {
    return new LanguageTag<`${T}-${R}`>((this.$tag.format() + '-' + region.toString()) as `${T}-${R}`)
  }
}
