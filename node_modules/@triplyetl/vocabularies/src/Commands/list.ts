import { type CommandModule } from 'yargs'
import getJobs from '../Utils/getJobs.js'

const $jobs = getJobs()

export const list: CommandModule = {
  command: 'list [vocabs...]',
  describe: 'list available vocabularies',
  builder: {
    format: {
      alias: 'f',
      choices: ['ttl', 'txt'],
      default: 'txt'
    },
    vocabs: {
      type: 'string',
      hidden: true,
      choices: $jobs.map((job) => job.prefix),
      describe: 'List only these vocabularies'
    }
  },
  handler: async (argv) => {
    let jobs = $jobs
    if (argv.vocabs !== undefined) {
      jobs = $jobs.filter((job) => (argv.vocabs as string[]).includes(job.prefix))
    }
    for (const job of jobs) {
      if (argv.format === 'ttl') {
        process.stdout.write(`prefix ${job.prefix}: <${job.iri}>\n`)
      } else {
        process.stdout.write(`${job.prefix}\t${job.iri}\n`)
      }
    }
  }
}
