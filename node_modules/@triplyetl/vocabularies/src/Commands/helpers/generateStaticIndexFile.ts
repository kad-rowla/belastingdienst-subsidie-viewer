import path from 'path'
import chalk from 'chalk'
import { writeFileSync, existsSync } from 'fs'
import type Job from '../../Interfaces/Job.js'
import { createRequire } from 'node:module'
import type Vocab from '../../Interfaces/Vocab.js'
const require = createRequire(import.meta.url)

export default function generateStaticIndexFile (jobs: Job[]): any {
  const vocabs: Vocab[] = []
  for (const job of jobs) {
    const sourceFile = path.join(process.cwd(), 'static', 'Vocabularies', 'Generated', `${job.prefix}.json`)
    if (!existsSync(sourceFile)) {
      console.error(chalk.red(`Warning: missing expected sourcefile 'static/Vocabularies/Generated/${job.prefix}.json'`))
      continue
    }
    const vocab: Vocab = require(sourceFile)
    delete vocab.items
    vocabs.push(vocab)
  }
  writeFileSync(path.join(process.cwd(), 'static', 'Vocabularies', 'index.json'), JSON.stringify(vocabs, null, 2), 'utf-8')
}
