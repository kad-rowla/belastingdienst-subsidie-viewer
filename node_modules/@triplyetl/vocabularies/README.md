# Vocabularies

This repository contains some common Linked Data vocabularies converted to Typescript. 
This provides users of this repo an easy and convenient way to use them in ETL's.

## Prerequisites
This tool creates temporary datasets and queries in a TriplyDB Instance defined by a [TriplyDB API Token](https://triply.cc/docs/api-token/). Your token should be placed in a file `.env` in the root folder of this repository using the environment variable name `TOKEN`. 

**Example content `.env`:**
```
TOKEN=icJ9UNJIXOIIcsIJCbC6pzieynkhG1RVIIi5.Aciaa0NO3iTdZzxJL8jmHNjLWdogw52jMUijDMtiFcfjoiMebwNoRi2FIMkOy6ZtlcjXHWwiGEGcF9iYiJI5YzAQDDartZy0MxH9IkhRGzjiRNxOIN2TDGuZiYzTamt5kcmYijbuUguQR5n5uIhIxwin2VIU9kNMMGWdyRw4w3kZoYp0NIji3QY1zjmiUiS.-VfgjISFfAq0hUYbzr3jNSe2GP4lwerbfT6_fB-HTRE
```

## Install
To install this tool, you must follow these steps:
```sh
git clone https://git.triply.cc/triply/vocabularies
cd vocabularies
npm install
npm run build
```

Note you only have to build once, adding new vocabularies does not require you to rebuild your code.

## Creating vocabularies

You can generate one ore more vocabulary files by running the following command:
```sh
npx vocabularies generate [vocabs...]
```

For example:
```sh
npx vocabularies generate crm sdo dct
```

A list of available vocabularies is available, see further in this documentation.

In most cases you would only want to create or update a single or a few vocabularies. If you want to (re)create all vocabularies, use this command:
```sh
npx vocabularies generate --all
```

## List available vocabularies

A list of available vocabularies is available by running this command:
```sh
npx vocabularies list
```

If you want to generate a list of prefixes you can use in a Turtle file use this command:
```sh
npx vocabularies list --format ttl
```

To list just some specific vocabularies, use this command for example:
```sh
npx vocabularies list sdo rdf rdfs sh --format ttl
```

## Add a new vocabulary job

If you want to add a new job that will generate a new vocabulary file, you can use this command:
```sh
npx vocabularies add --prefix <prefix> --iri <iri> --account <account> [--dataset <dataset>] [--objectName <objectName>]
```

All options can also be used using the shorthand notion (eg. `--prefix` => `-p`)

For example:
```sh
npx vocabularies add -p ex --iri http://ex.com/ -a ex
```

If a vocabulary job already exists an error is shown.

## Update vocabulary job

If you want to update an existing job, you can use this command:
```sh
npx vocabularies add --prefix <prefix> --iri <iri> --account <account> [--dataset <dataset>] [--objectName <objectName>] --update
```

All options can also be used using the shorthand notion (eg. `--prefix` => `-p`)

For example:
```sh
npx vocabularies add -p ex --iri http://ex.com/ -a ex --update
```

If a vocabulary job does not exist a new entry will be created, otherwise the existing one will be updated.

## Remove exisisting vocabulary jobs

If you want to remove one or more existing jobs, you can use this command:
```sh
npx vocabularies remove vocab1 vocab2 ...
```
For example, this wil remove the vocabulary job "foo" and "bar":
```sh
npx vocabularies remove foo bar
```

## Change the vocabulary jobs manually
If you do not want to use the provided tools to manipulate the list of vocabulary job, you can open the file `<projectroot>/vocabularies.json`. If you use Visual Studio Code to do this you will get validation and autocomplete that will help you in generating a JSON file using the correct format.

Do not forget to run the `npx vocabs generate` tool after you have made manual changes to this file.

## Source control and publishing
If you want to make changes to the vocabulary package, follow the instructions in this README. Make sure to create a feature branch and publish that branch to Gitlab. Go over to Gitlab to create a new [Merge request](https://git.triply.cc/triply/vocabularies/-/merge_requests) that merges your feature branch into the `main` branch.

After your merge is done, you can switch back to the `main` branch and publish a new package (assuming you have the correct rights in Gitlab) by running the following commands:
```bash
npm version patch
```

## Example use in TriplyETL
```ts
import { Etl } from "@triplyetl/etl/generic"
import { triple, iri } from '@triplyetl/etl/ratt'
import { rdf, a, prefixer } from '@triplyetl/vocabularies';

export default () => {
  const etl = new Etl()
  etl.use(
    fromJson({ className: 'Brewery'})
    triple(iri(prefixer.sdo, 'className', a, rdf.Class)),
  )
  return etl
}
```
