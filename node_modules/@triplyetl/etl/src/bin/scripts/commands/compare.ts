import { CommandModule } from "yargs";
import chalk from "chalk";
import Etl from "../../../generic/Etl.js";
import { existsSync } from "fs";
import { compareGraphs, loadRdf, Source } from "../../../generic/index.js";

const cmd: CommandModule = {
  command: "compare <rdf-file-1> <rdf-file-2>",
  describe: "Compare the contents of two RDF files",
  handler: async (_argv) => {
    const graph1 = _argv.rdfFile1 as string;
    const graph2 = _argv.rdfFile2 as string;
    if (!existsSync(graph1)) {
      console.error(chalk.red(`graph '${graph1}' not found`));
      process.exit(1);
    }

    if (!existsSync(graph2)) {
      console.error(chalk.red(`graph '${graph2}' not found`));
      process.exit(1);
    }
    const app = new Etl();
    app.use(loadRdf(Source.file(graph1)), compareGraphs(Source.file(graph2), { throw: false }));
    await app.run();
  },
};
export default cmd;
