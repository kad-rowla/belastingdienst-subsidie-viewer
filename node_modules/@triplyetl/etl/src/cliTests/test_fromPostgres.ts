//external dependencies

import { Etl, fromPostgres } from "../generic/index.js";

/**
 * To use this test, set up the example database described in #5051.
 */
export default async function (): Promise<Etl> {
  // Test precedence by setting things to different values in different places
  // with only the value that is expected to precede being correct.
  // correct configuration: "postgres://postgres:example@localhost:5432/demo"

  process.env.POSTGRES_HOST = "wronghost";
  process.env.POSTGRES_PORT = "5432";
  const app = new Etl({ defaultGraph: "https://default.com/" });
  app.use(
    fromPostgres('SELECT * FROM "aircrafts"', {
      url: "postgres://postgres:example@randomhost:1098/demo",
      host: "localhost",
    })
  );
  app.use(async (ctx) => {
    console.info(ctx.record);
  });
  return app;
}
