import { Etl, fromXlsx, Source, when } from "../generic/index.js";
import { addIri, pairs, triple } from "../ratt/index.js";
import { a, Iri, sdo } from "@triplyetl/vocabularies";

const prefix = new Iri("http://ex.com/");
const cities = pairs("S", [a, sdo.City], [sdo.name, "City"]);

const addresses = [
  pairs("S", [a, sdo.Person], [sdo.familyName, "last name"]),
  when("street", triple("S", sdo.streetAddress, "street")),
  when("first name", triple("S", sdo.givenName, "street")),
];

export default async (): Promise<Etl> => {
  const app = new Etl();
  app.use(
    fromXlsx(Source.file("./src/__tests__/resources/xlsxFiles/addresses_and_cities.xlsx")),
    addIri({ prefix, key: "S", content: "$recordId" }),
    when((ctx) => ctx.record.$sheetName === "addresses", addresses),
    when((ctx) => ctx.record.$sheetName === "cities", cities),
  );
  return app;
};
