import { Middleware } from "../generic/index.js";
import { SourceGetter, StringSourceInfo } from "../generic/locations/sources/index.js";
import { addMwCallSiteToError, getQueryStrings } from "../utils/index.js";

// TODO @DocumentationTeam: add TS doc comment here
export default function logQuery(
  query: string | SourceGetter<"string", StringSourceInfo> | Array<string | SourceGetter<"string", StringSourceInfo>>,
): Middleware {
  return addMwCallSiteToError(
    async function _logQuery(ctx, next) {
      const queries = await getQueryStrings(ctx, query);
      console.info(queries.join("\n"));
      console.info();
      return next();
    },
    { sourceFuncName: "_logQuery" },
  );
}
