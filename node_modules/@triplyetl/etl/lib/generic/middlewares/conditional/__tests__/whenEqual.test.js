import chai from "chai";
import { getEtlForTestingNoExtractor } from "../../../../ratt/__tests__/getEtlForTesting.js";
import { getFactory } from "@triplydb/data-factory";
import whenEqual from "../whenEqual.js";
import { addValue } from "../../../../ratt/middlewares/transformations/index.js";
import { fromJson } from "../../index.js";
const assert = chai.assert;
describe("Conditional.whenEqual ", () => {
    it("Should work on single values", () => {
        return getEtlForTestingNoExtractor([
            fromJson([
                {
                    foo: "bar",
                    num: 1,
                    true: true,
                    false: false,
                },
            ]),
            whenEqual("foo", "bar", addValue({ content: true, key: "checkIsEqual#10" })),
            whenEqual("num", 1, addValue({ content: true, key: "checkIsEqual#11" })),
            whenEqual("true", true, addValue({ content: true, key: "checkIsEqual#12" })),
            whenEqual("false", false, addValue({ content: true, key: "checkIsEqual#13" })),
            whenEqual("bar", "1", addValue({ content: true, key: "checkIsEqual#20" })),
            whenEqual("foo", "not-bar", addValue({ content: true, key: "checkIsEqual#21" })),
            whenEqual("NotAKey", "NotAKey", addValue({ content: true, key: "checkIsEqual#22" })),
            async (ctx, next) => {
                for (let i = 10; i <= 13; i++)
                    assert.doesNotThrow(() => ctx.getBoolean(`checkIsEqual#${i}`));
                for (let i = 20; i <= 22; i++)
                    assert.throws(() => ctx.getBoolean(`checkIsEqual#${i}`));
                return next();
            },
        ]).run();
    });
    it("Should work on tuple values", () => {
        return getEtlForTestingNoExtractor([
            fromJson([
                {
                    foo: "noot",
                    num: 1,
                    true: true,
                    false: false,
                },
            ]),
            whenEqual("foo", ["aap", "noot", "mies"], addValue({ content: true, key: "checkIsEqual#10" })),
            whenEqual("foo", [1, "noot", "mies"], addValue({ content: true, key: "checkIsEqual#11" })),
            whenEqual("num", [undefined, 1, true], addValue({ content: true, key: "checkIsEqual#12" })),
            whenEqual("true", [true], addValue({ content: true, key: "checkIsEqual#13" })),
            whenEqual("false", [true, false], addValue({ content: true, key: "checkIsEqual#14" })),
            whenEqual("bar", ["1", "BAR", "Bar"], addValue({ content: true, key: "checkIsEqual#20" })),
            whenEqual("foo", [true, "not-bar", undefined], addValue({ content: true, key: "checkIsEqual#21" })),
            whenEqual("NotAKey", ["NotAKey"], addValue({ content: true, key: "checkIsEqual#22" })),
            async (ctx, next) => {
                for (let i = 10; i <= 14; i++)
                    assert.doesNotThrow(() => ctx.getBoolean(`checkIsEqual#${i}`));
                for (let i = 20; i <= 22; i++)
                    assert.throws(() => ctx.getBoolean(`checkIsEqual#${i}`));
                return next();
            },
        ]).run();
    });
    it("Should work on objects", () => {
        const iri = getFactory().namedNode("http://ex.com");
        return getEtlForTestingNoExtractor([
            fromJson([
                {
                    foo: { bar: "FooBar" },
                    bar: [1, 2, true],
                    iri: iri,
                },
            ]),
            whenEqual("foo", { bar: "FooBar" }, addValue({ content: true, key: "checkIsEqual#10" })),
            whenEqual("bar", [1, 2, true], addValue({ content: true, key: "checkIsEqual#11" })),
            whenEqual("iri", iri, addValue({ content: true, key: "checkIsEqual#12" })),
            whenEqual("foo", { bar: "NoFooBar" }, addValue({ content: true, key: "checkIsEqual#20" })),
            async (ctx, next) => {
                for (let i = 10; i <= 12; i++)
                    assert.doesNotThrow(() => ctx.getBoolean(`checkIsEqual#${i}`));
                for (let i = 20; i <= 20; i++)
                    assert.throws(() => ctx.getBoolean(`checkIsEqual#${i}`));
                return next();
            },
        ]).run();
    });
});
//# sourceMappingURL=whenEqual.test.js.map