/**
 * A test where we're reading multiple ttl files from a directory and validating them
 * Use for testing of performance
 */
import fs from "fs-extra";
let organization = "rkd";
import { Etl, Source } from "../generic/index.js";
import { validate } from "../shacl/index.js";
import { parse } from "@triplydb/data-factory";
if (process.env["DATA"] === "Test")
    organization = organization + "-test";
export default async function () {
    const app = new Etl({
        defaultGraph: "http://bla",
        sources: {
            shapes: Source.file(`./shapes.ttl`),
        },
    });
    const inputDir = "shapes";
    let inputFiles = await fs.readdir(inputDir);
    app.use(async (ctx, next) => {
        for (const inputFile of inputFiles) {
            const store = ctx.app.getNewStore();
            store.addQuads(parse(await fs.readFile(`${inputDir}/` + inputFile, "utf-8")));
            await next({}, store);
        }
    }, validate([app.sources.shapes]));
    return app;
}
//# sourceMappingURL=test_shaclValidateDir.js.map